<div class="greyout"></div>
<div class="container">
  <button 
    (click)="onClose()"
    type="button" 
    class="close pull-right" 
    aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  <div class="jumbotron">
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <div class="col-xs-12 col-sm-6">
          <div class="form-group">
            <h3>Conversation Name</h3>
            <input
              formControlName="name"
              class="form-control"
              type="text">
          </div>
        </div>
        <div class="col-xs-12 col-sm-6">
          <div class="row">
            <div
              formArrayName="participants"
              #participants
              class="col-xs-12">
              <div class="row">
                <h3>Participants
                  <button
                    (click)="onAddParticipant()"
                    [disabled]="!editForm.get('participants').valid"
                    type="button"
                    class="btn btn-success pull-right">Add</button>
                </h3>
                <div
                  class="col-xs-12 participant"
                  [ngClass]="{ 'hide-auto': editForm.get('participants').controls[i].valid }"
                  *ngFor="let participantCtrl of getParticipantsArray.controls; let i = index">
                  <input
                    auto-complete
                    [source]="friendNames"
                    no-match-found-text="Invalid Username"
                    (valueChanged)="forceCheck($event, i)"
                    [formControlName]="i + ''"
                    class="form-control"
                    type="text">
                  <button 
                    (click)="onRemoveParticipant(i)"
                    type="button" 
                    class="close" 
                    data-dismiss="alert"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <div
                    *ngIf="editForm.get('participants').get('' + i).pending || ( editForm.get('participants').get('' + i).invalid && ( editForm.get('participants').get('' + i).dirty || editForm.get('participants').get('' + i).touched ) && editForm.get('participants').get('' + i).errors['usernameInvalid'] )"
                    class="small">Username Invalid</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-12">
          <button
            [disabled]="editForm.invalid || editForm.pending"
            class="btn btn-primary"
            type="submit">Submit</button>
          <button
            *ngIf="editMode"
            (click)="onRemoveConversation()"
            class="btn btn-danger"
            type="button">Delete</button>
        </div>
      </div>
    </form>
  </div>
</div>
