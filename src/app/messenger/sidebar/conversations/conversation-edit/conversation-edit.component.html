<div (click)="onClose()" class="greyout"></div>
<div class="container">
  <button 
    (click)="onClose()"
    type="button" 
    class="close pull-right" 
    aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  <div class="jumbotron">
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <div class="col-xs-12 col-sm-5">
          <div class="row">
            <div class="form-group">
              <h3>Conversation Name</h3>
              <input
                formControlName="name"
                class="form-control"
                type="text">
            </div>
          </div>
        </div>
        <div class="col-xs-12 col-sm-7">
          <div class="row">
            <div class="col-xs-1">
              <div class="row">
                <div class="color-space"></div>
                <div
                  class="col-xs-12 participant"
                  *ngFor="let color of colors; let i = index">
                  <input
                    [(colorPicker)]="colors[i].color"
                    [style.background]="colors[i].color"
                    [cpOKButton]="true"
                    [cpOutputFormat]="hex"
                    type="button"
                    class="color form-control">
                </div>
              </div>
            </div>
            <div
              formArrayName="participants"
              #participants
              class="col-xs-5">
              <div class="row">
                <h3>Participants</h3>
                <div
                  class="col-xs-12 participant"
                  [ngClass]="{ 'hide-auto': editForm.get('participants').controls[i].valid }"
                  *ngFor="let participantCtrl of getParticipantsArray().controls; let i = index">
                  <input
                    auto-complete
                    [source]="friendNames"
                    no-match-found-text="Invalid Username"
                    (valueChanged)="forceCheck($event, i)"
                    [formControlName]="i + ''"
                    class="form-control"
                    type="text">
                  <button 
                    (click)="onRemoveParticipant(i)"
                    type="button" 
                    class="close" 
                    data-dismiss="alert"
                    aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  <div
                    *ngIf="editForm.get('participants').get('' + i).pending || ( editForm.get('participants').get('' + i).invalid && ( editForm.get('participants').get('' + i).dirty || editForm.get('participants').get('' + i).touched ) && editForm.get('participants').get('' + i).errors['usernameInvalid'] )"
                    class="small">Username Invalid</div>
                </div>
              </div>
            </div>
            <div
              formArrayName="nicknames"
              #nicknames
              class="col-xs-6">
              <div class="row">
                <h3>Nicknames</h3>
                <div
                  class="col-xs-12 participant"
                  [ngClass]="{ 'hide-auto': editForm.get('participants').controls[i].valid }"
                  *ngFor="let participantCtrl of getParticipantsArray().controls; let i = index">
                  <input
                    [formControlName]="i + ''"
                    class="form-control"
                    type="text">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-12">
          <div class="row">
            <button
              [disabled]="editForm.invalid || editForm.pending"
              class="btn btn-primary"
              type="submit">Submit</button>
            <button
              *ngIf="editMode"
              (click)="onRemoveConversation()"
              class="btn btn-danger"
              type="button">Delete</button>
            <button
              (click)="onAddParticipant()"
              [disabled]="!editForm.get('participants').valid"
              type="button"
              class="btn btn-success pull-right">Add</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
